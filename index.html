<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>SPECTRA ‚Äî The Visual Storytelling Engine</title>
<style>
    /* --- CSS for Spectra --- */
    :root {
        --bg: #0d0d1a;
        --fg: #f0f4ff;
        --accent: #d896ff; /* A rich, artistic purple */
        --muted: #aab8c2;
        --rim: #2d2d3e;
        --pulse: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse { 0%,100%{opacity:.7} 50%{opacity:1} }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    * { box-sizing: border-box; font-family: 'JetBrains Mono', Consolas, Monaco, monospace; }
    body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    header {
        padding: 16px 20px;
        border-bottom: 2px solid var(--rim);
        background: linear-gradient(180deg, rgba(45,45,62,0.8), rgba(18,18,28,0.9));
        backdrop-filter: blur(10px);
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    header h1 {
        font-size: 1.2rem;
        margin: 0;
        color: var(--accent);
        letter-spacing: 1px;
    }
    .tag {
        border: 1px solid var(--rim);
        border-radius: 12px;
        padding: 8px 12px;
        background: linear-gradient(145deg, #2d2d3e, #1d1d2e);
        color: var(--muted);
        box-shadow: inset 0 1px 2px rgba(255,255,255,0.1);
    }

    main {
        flex: 1;
        display: grid;
        place-items: center;
        padding: 20px;
        position: relative;
    }
    
    .stage {
        position: relative;
        width: min(95vw, 1400px);
        aspect-ratio: 16/9;
        border: 2px solid var(--rim);
        border-radius: 20px;
        overflow: hidden;
        background: #000;
        box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 50px rgba(0,0,0,0.8);
    }
    video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    canvas#paint {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    .ui-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
        animation: fadeIn 0.5s ease-in-out;
    }
    
    /* Narrative & Sound Assistant */
    #assistant-box {
        position: absolute;
        bottom: 20px;
        left: 20px;
        max-width: 250px;
        padding: 12px 16px;
        background: rgba(18,18,28,0.9);
        backdrop-filter: blur(15px);
        border: 1px solid var(--rim);
        border-radius: 12px;
        color: var(--fg);
        font-size: 0.9rem;
        transition: opacity 0.3s ease;
        opacity: 0;
    }
    #assistant-box.active { opacity: 1; }
    #assistant-box .title {
        color: var(--accent);
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .mood-selector {
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .mood-button {
        width: 60px;
        height: 60px;
        border: 2px solid var(--rim);
        border-radius: 12px;
        background: linear-gradient(145deg, #2d2d3e, #1d1d2e);
        display: grid;
        place-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .mood-button:hover {
        border-color: var(--accent);
        transform: scale(1.05);
    }
    .mood-button.active {
        border-color: var(--accent);
        box-shadow: 0 0 15px var(--accent);
    }
    .mood-button span { font-size: 2rem; }

    .controls {
        margin-top: 25px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
        padding: 20px;
        border-radius: 15px;
        background: rgba(30,42,69,0.3);
        backdrop-filter: blur(10px);
        border: 1px solid var(--rim);
    }
    button {
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 1px solid var(--rim);
        border-radius: 12px;
        padding: 8px 14px;
        background: linear-gradient(145deg, #2d2d3e, #1d1d2e);
        color: var(--fg);
    }
    button.primary {
        border-color: var(--accent);
        color: var(--accent);
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    footer {
        padding: 20px;
        text-align: center;
        color: var(--muted);
        font-size: .9rem;
    }
</style>
</head>
<body>

<header>
    <h1>SPECTRA ‚Äî The Visual Storytelling Engine</h1>
    <span class="tag">Mood-Driven</span>
    <span class="tag">Narrative Focus</span>
    <span class="tag">Emotional Design</span>
</header>

<main>
    <div class="stage">
        <video id="vf" playsinline autoplay muted></video>
        <canvas id="paint"></canvas>

        <div class="ui-overlay">
            <div class="mood-selector">
                <div class="mood-button" data-mood="nostalgia"><span>üåÖ</span></div>
                <div class="mood-button" data-mood="suspense"><span>üïµÔ∏è</span></div>
                <div class="mood-button" data-mood="dreamscape"><span>‚ú®</span></div>
            </div>
            <div id="assistant-box">
                <div class="title">Narrative Assistant</div>
                <div id="assistant-message"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button id="start-btn" class="primary">üé• Start Session</button>
        <button id="snap-btn" disabled>üé¨ Capture Scene</button>
    </div>
</main>

<footer>
    Spectra empowers the artist within, bypassing technical jargon to focus on story and emotion.
</footer>

<script>
(async function(){
    const vf = document.getElementById('vf');
    const paint = document.getElementById('paint');
    const pctx = paint.getContext('2d', { willReadFrequently: true });
    
    const startBtn = document.getElementById('start-btn');
    const snapBtn = document.getElementById('snap-btn');
    const moodButtons = document.querySelectorAll('.mood-button');
    const assistantBox = document.getElementById('assistant-box');
    const assistantMessage = document.getElementById('assistant-message');

    let stream = null;
    let rafId = null;
    let activeMood = null;

    // --- Mood-based Color Grading Filters (Simulated) ---
    const moods = {
        nostalgia: {
            color: (r, g, b) => {
                const avg = (r + g + b) / 3;
                r = avg + (r - avg) * 0.5;
                g = avg + (g - avg) * 0.5;
                b = avg + (b - avg) * 0.5;
                return [r, g, b];
            },
            saturation: 0.8,
            contrast: 1.1,
            vignette: 1
        },
        suspense: {
            color: (r, g, b) => {
                const cool = 0.2 * r + 0.3 * g + 0.5 * b;
                return [cool * 0.8, cool * 0.9, cool * 1.1];
            },
            saturation: 0.3,
            contrast: 1.5,
            vignette: 0.5
        },
        dreamscape: {
            color: (r, g, b) => {
                const bright = Math.max(r, g, b);
                return [
                    r + (255 - r) * (bright/255) * 0.3,
                    g + (255 - g) * (bright/255) * 0.3,
                    b + (255 - b) * (bright/255) * 0.3
                ];
            },
            saturation: 1.5,
            contrast: 0.8,
            vignette: 0
        }
    };

    // --- Core Logic Functions ---
    async function startCamera() {
        if (stream) stopCamera();
        try {
            const constraints = { video: { facingMode: 'environment' } };
            stream = await navigator.mediaDevices.getUserMedia(constraints);
            vf.srcObject = stream;
            await vf.play();
            
            const dpr = window.devicePixelRatio || 1;
            paint.width = vf.videoWidth * dpr;
            paint.height = vf.videoHeight * dpr;
            paint.style.width = vf.videoWidth + 'px';
            paint.style.height = vf.videoHeight + 'px';
            pctx.scale(dpr, dpr);
            
            loop();
            snapBtn.disabled = false;
            assistantBox.classList.add('active');
            showAssistantMessage('Welcome, storyteller. Select a mood to begin your narrative.');
        } catch(e) {
            alert('Camera unavailable or permission denied.');
        }
    }

    function stopCamera() {
        if (rafId) cancelAnimationFrame(rafId);
        if (stream) stream.getTracks().forEach(t => t.stop());
        stream = null;
        snapBtn.disabled = true;
        assistantBox.classList.remove('active');
    }

    function loop() {
        rafId = requestAnimationFrame(loop);
        
        pctx.drawImage(vf, 0, 0, vf.videoWidth, vf.videoHeight);
        
        if (activeMood) {
            const imageData = pctx.getImageData(0, 0, vf.videoWidth, vf.videoHeight);
            applyMoodFilter(imageData, moods[activeMood]);
            pctx.putImageData(imageData, 0, 0);
        }
    }

    function applyMoodFilter(imageData, mood) {
        const data = imageData.data;
        const width = imageData.width;
        const height = imageData.height;
        const centerX = width / 2;
        const centerY = height / 2;
        const maxDist = Math.sqrt(centerX*centerX + centerY*centerY);

        for (let i = 0; i < data.length; i += 4) {
            let [r, g, b] = [data[i], data[i+1], data[i+2]];

            // Apply emotional color grade
            [r, g, b] = mood.color(r, g, b);

            // Apply contrast
            r = ((r - 128) * mood.contrast) + 128;
            g = ((g - 128) * mood.contrast) + 128;
            b = ((b - 128) * mood.contrast) + 128;
            
            // Apply saturation
            const gray = 0.299 * r + 0.587 * g + 0.114 * b;
            r = gray + mood.saturation * (r - gray);
            g = gray + mood.saturation * (g - gray);
            b = gray + mood.saturation * (b - gray);

            // Apply vignette
            const x = (i / 4) % width;
            const y = Math.floor((i / 4) / width);
            const dist = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
            const vignetteAmt = Math.pow(dist / maxDist, 2) * mood.vignette;
            
            r = r * (1 - vignetteAmt);
            g = g * (1 - vignetteAmt);
            b = b * (1 - vignetteAmt);
            
            // Clamp and update
            data[i] = Math.max(0, Math.min(255, r));
            data[i+1] = Math.max(0, Math.min(255, g));
            data[i+2] = Math.max(0, Math.min(255, b));
        }
    }
    
    // --- Assistant & Capture ---
    function showAssistantMessage(message) {
        assistantMessage.textContent = message;
    }

    function captureStill() {
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = vf.videoWidth;
        tempCanvas.height = vf.videoHeight;
        const ctx = tempCanvas.getContext('2d');
        ctx.drawImage(paint, 0, 0, tempCanvas.width, tempCanvas.height);
        
        const a = document.createElement('a');
        a.download = `Spectra_Scene_${Date.now()}.png`;
        a.href = tempCanvas.toDataURL('image/png');
        a.click();
    }
    
    // --- Event Listeners ---
    startBtn.addEventListener('click', startCamera);
    snapBtn.addEventListener('click', captureStill);
    
    moodButtons.forEach(button => {
        button.addEventListener('click', () => {
            moodButtons.forEach(b => b.classList.remove('active'));
            button.classList.add('active');
            activeMood = button.dataset.mood;
            showAssistantMessage(`You've selected the '${activeMood}' mood. What story will you tell?`);
        });
    });
})();
</script>
</body>
</html>
